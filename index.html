<!DOCTYPE html>
<html>
<head>
  <title>AI Shape Classifier</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #webcam-container { margin: 20px auto; }
    #label-container div { font-size: 18px; margin: 8px; }
    #formula-box { margin-top: 20px; font-weight: bold; white-space: pre-line; }
    #input-form { margin-top: 20px; display: none; }
    input, select { margin: 5px; padding: 5px; width: 130px; }
    button { margin: 10px; padding: 8px 15px; font-size: 15px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.17.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
</head>
<body>
  <h1>üß† AI Shape Classifier</h1>
  <button onclick="init()">üì∑ Start Camera</button>
  <button onclick="flipCamera()">üîÑ Flip Camera</button>
  <button onclick="captureShape()" id="capture-btn" style="display:none;">üì∏ Capture Shape</button>
  <button onclick="reset()" id="reset-btn" style="display:none;">üîÅ Try Another Shape</button>

  <div id="webcam-container"></div>
  <div id="label-container"></div>
  <div id="formula-box"></div>
  <div id="input-form"></div>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/1Ht45q_Jz/";
    let model, webcam, labelContainer, maxPredictions;
    let currentShape = "";
    let freeze = false;
    let predictionResult = null;
    let flip = false;

    const formulas = {
      "Rectangle": "Area = l √ó b\nPerimeter = 2 √ó (l + b)",
      "Triangle": "Area = ¬Ω √ó b √ó h\nPerimeter = a + b + c",
      "Square": "Area = side¬≤\nPerimeter = 4 √ó side",
      "Circle": "Area = œÄ √ó r¬≤\nPerimeter = 2 √ó œÄ √ó r",
      "Hexagon": "Area = (3‚àö3 √ó side¬≤)/2\nPerimeter = 6 √ó side"
    };

    function capitalize(text) {
      return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();
    }

    async function init() {
      if (webcam && webcam.webcam && webcam.webcam.srcObject) {
        const tracks = webcam.webcam.srcObject.getTracks();
        tracks.forEach(track => track.stop());
      }

      document.getElementById("formula-box").innerText = "";
      document.getElementById("input-form").style.display = "none";
      document.getElementById("input-form").innerHTML = "";
      document.getElementById("reset-btn").style.display = "none";
      document.getElementById("capture-btn").style.display = "inline-block";

      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      webcam = new tmImage.Webcam(200, 200, flip);
      await webcam.setup({ facingMode: flip ? "user" : "environment" });
      await webcam.play();

      document.getElementById("webcam-container").innerHTML = "";
      document.getElementById("webcam-container").appendChild(webcam.canvas);

      labelContainer = document.getElementById("label-container");
      labelContainer.innerHTML = "";
      for (let i = 0; i < maxPredictions; i++) {
        labelContainer.appendChild(document.createElement("div"));
      }

      freeze = false;
      predictLoop();
    }

    function flipCamera() {
      flip = !flip;
      init();
    }

    async function predictLoop() {
      if (freeze) return;
      webcam.update();
      const prediction = await model.predict(webcam.canvas);
      prediction.sort((a, b) => b.probability - a.probability);
      predictionResult = prediction[0];
      const shapeName = capitalize(predictionResult.className.trim());

      labelContainer.childNodes[0].innerHTML =
        `üî∑ Shape: ${shapeName}<br>üéØ Confidence: ${(predictionResult.probability * 100).toFixed(2)}%`;

      for (let i = 1; i < maxPredictions; i++) {
        labelContainer.childNodes[i].innerHTML = "";
      }

      setTimeout(predictLoop, 500);
    }

    function captureShape() {
      if (!predictionResult || predictionResult.probability < 0.6) {
        alert("No clear shape detected. Please hold a visible shape in front of the camera.");
        return;
      }

      freeze = true;
      currentShape = capitalize(predictionResult.className.trim());

      document.getElementById("formula-box").innerText =
        "üìê Formula:\n" + (formulas[currentShape] || "No formula available");

      showInputForm(currentShape);
      document.getElementById("reset-btn").style.display = "inline-block";
      document.getElementById("capture-btn").style.display = "none";
    }

    function showInputForm(shape) {
      const form = document.getElementById("input-form");
      form.innerHTML = "";
      let fields = "";

      const unitSelector = `<select id="unit">
        <option value="cm">cm</option>
        <option value="m">m</option>
        <option value="in">inch</option>
      </select>`;

      switch (shape) {
        case "Square":
          fields = `<input id="side" type="number" placeholder="Side"> ${unitSelector}`; break;
        case "Rectangle":
          fields = `<input id="length" type="number" placeholder="Length">
                    <input id="breadth" type="number" placeholder="Breadth"> ${unitSelector}`; break;
        case "Circle":
          fields = `<input id="radius" type="number" placeholder="Radius"> ${unitSelector}`; break;
        case "Triangle":
          fields = `<input id="base" type="number" placeholder="Base">
                    <input id="height" type="number" placeholder="Height"><br>
                    <input id="a" type="number" placeholder="Side a">
                    <input id="b" type="number" placeholder="Side b">
                    <input id="c" type="number" placeholder="Side c"> ${unitSelector}`; break;
        case "Hexagon":
          fields = `<input id="side" type="number" placeholder="Side"> ${unitSelector}`; break;
        default:
          form.style.display = "none";
          return;
      }

      form.innerHTML = `
        <div>${fields}</div>
        <button onclick="calculate('${shape}')">‚úÖ Calculate</button>
        <div id="result" style="margin-top:10px;"></div>
      `;
      form.style.display = "block";
    }

    function calculate(shape) {
      const getVal = id => parseFloat(document.getElementById(id)?.value) || 0;
      const unit = document.getElementById("unit").value;
      let area = 0, perimeter = 0;

      switch (shape) {
        case "Square":
          const side = getVal("side");
          area = side ** 2;
          perimeter = 4 * side;
          break;
        case "Rectangle":
          const l = getVal("length"), b = getVal("breadth");
          area = l * b;
          perimeter = 2 * (l + b);
          break;
        case "Circle":
          const r = getVal("radius");
          area = Math.PI * r * r;
          perimeter = 2 * Math.PI * r;
          break;
        case "Triangle":
          const base = getVal("base"), height = getVal("height");
          const a = getVal("a"), bb = getVal("b"), c = getVal("c");
          area = 0.5 * base * height;
          perimeter = a + bb + c;
          break;
        case "Hexagon":
          const s = getVal("side");
          area = ((3 * Math.sqrt(3)) / 2) * s * s;
          perimeter = 6 * s;
          break;
      }

      const resultBox = document.getElementById("result");
      resultBox.innerHTML = `
        üìè Area = ${area.toFixed(2)} ${unit}<sup>2</sup><br>
        üîÅ Perimeter = ${perimeter.toFixed(2)} ${unit}`;
    }

    function reset() {
      freeze = false;
      predictionResult = null;
      document.getElementById("input-form").style.display = "none";
      document.getElementById("input-form").innerHTML = "";
      document.getElementById("formula-box").innerText = "";
      document.getElementById("reset-btn").style.display = "none";
      document.getElementById("capture-btn").style.display = "inline-block";
      predictLoop();
    }
  </script>
</body>
</html>
